{% extends 'layout.html' %}

{% block title %}
    Incidentes
{% endblock %}

{% block content %}
    <div class="page-content-inner">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption">
                    <span class="caption-subject bold uppercase">Incidentes</span>
                </div>
            </div>
            <div class="portlet-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead>
                        <tr>
                            <th></th>
                            <th>Fecha</th>
                            <th>Mensaje</th>
                            <th>Conductor</th>
                            <th>Vehículo</th>
                            <th>Ubicación</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for object in object_list %}
                            <tr>
                                <td>
                                    {{ object.id }}
                                </td>
                                <td>
                                    {{ object.when|date:"d-M-Y H:i:s" }}
                                </td>
                                <td>
                                    {{ object.message }}
                                </td>
                                <td>
                                    {{ object.driver.first_name }} {{ object.driver.last_name }}
                                </td>
                                <td>
                                    {{ object.vehicle.plaque }}
                                </td>
                                <td>
                                    <a href="#" class="btn green-jungle"  data-toggle="modal" data-target="#myModal">
                                        <span class="fa fa-map-maker"></span>
                                        Ver Ubicación
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">Mapa</h4>
                </div>
                <div class="modal-body">
                    <div id="map" style="height: 300px"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script_custom %}
    <script>
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 4,
                center: {
                    lat:-16.409739933377747,
                    lng:-71.5704345703125
                }
            });
        }

        function setMarker(vlat, vlng, message) {
            var marker = new google.maps.Marker({
                position: {
                    lat: vlat,
                    lng: vlng
                },
                map: map,
                title: message
            });
        }

        $(document).ready(function () {
            $('.see-btn').click(function (event) {
                var lat = $(this).data('lat');
                var lng = $(this).data('lng');
                var message = $(this).data('message');
                setMarker(lat, lng, message);
            });
        });
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDsJeLjJDJtTGCf4pQkdHftCL6F8RLxHCo&signed_in=true&libraries=drawing&callback=initMap"></script>
{% endblock %}